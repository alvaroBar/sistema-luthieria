{% extends "base.html" %}

{% block title %}Lista de Clientes{% endblock %}

{% block head %}
    <!-- Importação do Font Awesome para o ícone de guitarra -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock %}

{% block content %}
    <div class="page-header">
        <div class="header-title">
            <h1>Clientes Cadastrados</h1>
        </div>
        <a id="btn-novo-cliente-top" href="{{ url_for('main.novo_cliente') }}" class="action-button"
           style="background-color: var(--cor-sucesso-botao);">&#43; Cadastrar Novo Cliente</a>
    </div>

    {% if source == 'os' %}
    <div class="info-banner">
        <p><b>Primeiro passo:</b> Busque o cliente e, caso ainda não tenha, faça o cadastro. Depois, clique no ícone de guitarra
            <i class="fas fa-guitar" style="font-size: 0.9em;"></i> para selecionar o equipamento e abrir a OS.</p>
    </div>
    {% endif %}

    <div class="card">
        <form method="GET" action="{{ url_for('main.listar_clientes') }}" class="search-form">
            <input type="text" name="busca" placeholder="Buscar por nome ou CPF..." value="{{ termo_busca or '' }}">
            <button type="submit" class="button--primary">Buscar</button>
            <a href="{{ url_for('main.listar_clientes') }}" class="button--secondary">Limpar</a>
        </form>

        {% if clientes %}
        <table class="data-table table-hover">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Celular / WhatsApp</th>
                    <th class="actions-column">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for cliente in clientes %}
                <tr class="clickable-row" data-href="{{ url_for('main.listar_equipamentos', cliente_id=cliente.id) }}">
                    <td>{{ cliente.nome }}</td>
                    <td>{{ cliente.celular_whatsapp }}</td>
                    <td class="actions-cell">
                        <a href="{{ url_for('main.listar_equipamentos', cliente_id=cliente.id) }}" class="action-link action-link--equipamentos" title="Ver Equipamentos">
                            <i class="fas fa-guitar"></i>
                        </a>
                        <a href="{{ url_for('main.editar_cliente', cliente_id=cliente.id) }}" class="action-link action-link--edit" title="Editar">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                            </svg>
                        </a>
                        <form class="delete-form" action="{{ url_for('main.excluir_cliente', cliente_id=cliente.id) }}" method="POST">
                            <button type="submit" class="action-link action-link--delete" onclick="event.stopPropagation(); return confirm('Tem certeza que deseja excluir? Esta ação não pode ser desfeita.');" title="Excluir">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div style="text-align:center; padding: 20px;">
            <p>Nenhum cliente encontrado.</p>
            <a id="btn-novo-cliente-bottom" href="{{ url_for('main.novo_cliente') }}" class="action-button move-down hide" style="background-color: var(--cor-sucesso-botao); margin-top: 20px; display: inline-block;">
                &#43; Cadastrar Novo Cliente
            </a>
        </div>
        {% endif %}
    </div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Botão inferior animação
    const btnBottom = document.getElementById("btn-novo-cliente-bottom");
    if(btnBottom){
        setTimeout(() => {
            btnBottom.classList.remove('hide');
            btnBottom.classList.add('show');
        }, 200);
    }

    // Linha clicável para redirecionar ao listar equipamentos
    document.querySelectorAll(".clickable-row").forEach(row => {
        row.addEventListener("click", function(e) {
            // Evita o clique se for nos ícones de ação
            if(e.target.closest(".actions-cell")) {
                e.stopPropagation();
                return;
            };
            window.location.href = this.dataset.href;
        });
    });
});
</script>
{% endblock %}

